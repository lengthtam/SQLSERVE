BÀI TẬP 1:
          -- 12. Tìm các số hóa đơn đã mua sản phẩm có mã số “BB01” hoặc “BB02”, mỗi sản phẩm mua với số lượng từ 10 đến 20. 
          SELECT SOHD FROM CTHD
          WHERE MASP IN ('BB01', 'BB02') AND SL BETWEEN 10 AND 20
          GROUP BY SOHD;

          --13.	Tìm các số hóa đơn mua cùng lúc 2 sản phẩm có mã số “BB01” và “BB02”, mỗi sản phẩm mua với số lượng từ 10 đến 20. 
          SELECT SOHD
          FROM CTHD
          WHERE (MASP = 'BB01' AND SL BETWEEN 10 AND 20)
             OR (MASP = 'BB02' AND SL BETWEEN 10 AND 20)
          GROUP BY SOHD
          HAVING COUNT(DISTINCT MASP) = 2;
BÀI TẬP 2:
          -- 1.Tăng hệ số lương thêm 0.2 cho những giáo viên là trưởng khoa.
          UPDATE GIAOVIEN
          SET HESO = HESO + 0.2
          WHERE MAGV IN (SELECT TRGKHOA FROM KHOA);
          --2. Cập nhật giá trị điểm trung bình tất cả các môn học (DIEMTB) của mỗi học viên (tất cả các môn học đều có hệ số 1 và nếu học viên thi một môn nhiều lần, chỉ lấy điểm của lần thi sau cùng).
          UPDATE HOCVIEN
          SET DIEMTB = (
              SELECT AVG(DIEM)
              FROM KETQUATHI AS KQ
              WHERE KQ.MAHV = HOCVIEN.MAHV
              AND KQ.LANTHI = (
                  SELECT MAX(LANTHI)
                  FROM KETQUATHI
                  WHERE KETQUATHI.MAHV = KQ.MAHV AND KETQUATHI.MAMH = KQ.MAMH
              )
          );

          --3. Cập nhật giá trị cho cột GHICHU là “Cam thi” đối với trường hợp: học viên có một môn bất kỳ thi lần thứ 3 dưới 5 điểm.
          UPDATE HOCVIEN
          SET GHICHU = 'Cam thi'
          WHERE MAHV IN (
              SELECT DISTINCT MAHV
              FROM KETQUATHI
              WHERE LANTHI = 3 AND DIEM < 5
          );
          -- 4.Cập nhật giá trị cho cột XEPLOAI trong quan hệ HOCVIEN như sau:
          -- Nếu DIEMTB  9 thì XEPLOAI =”XS”
          -- Nếu 8  DIEMTB < 9 thì XEPLOAI = “G”
          -- Nếu 6.5  DIEMTB < 8 thì XEPLOAI = “K”
          -- Nếu 5  DIEMTB < 6.5 thì XEPLOAI = “TB”
          -- Nếu DIEMTB < 5 thì XEPLOAI = ”Y”
          UPDATE HOCVIEN
          SET XEPLOAI = CASE
              WHEN DIEMTB >= 9 THEN 'XS'
              WHEN DIEMTB >= 8 AND DIEMTB < 9 THEN 'G'
              WHEN DIEMTB >= 6.5 AND DIEMTB < 8 THEN 'K'
              WHEN DIEMTB >= 5 AND DIEMTB < 6.5 THEN 'TB'
              ELSE 'Y'
          END;


BÀI TẬP 3:
          -- 6.	Tìm tên những môn học mà giáo viên có tên “Tran Tam Thanh” dạy trong học kỳ 1 năm 2006.
          SELECT MAMH, TENMH FROM MONHOC
          WHERE MAMH IN (
          	SELECT DISTINCT MAMH 
          	FROM GIANGDAY GD INNER JOIN GIAOVIEN GV 
          	ON GD.MAGV = GV.MAGV 
          	WHERE HOTEN = 'Tran Tam Thanh' AND HOCKY = 1 AND NAM = 2006
          )
          
  
          -- 7.	Tìm những môn học (mã môn học, tên môn học) mà giáo viên chủ nhiệm lớp “K11” dạy trong học kỳ 1 năm 2006.
          SELECT MAMH, TENMH FROM MONHOC
          WHERE MAMH IN (
          	SELECT DISTINCT MAMH FROM GIANGDAY WHERE MAGV IN (
          		SELECT MAGVCN FROM LOP WHERE MALOP = 'K11'
          	) AND HOCKY = 1 AND NAM = 2006
          )
        
          -- 8.	Tìm họ tên lớp trưởng của các lớp mà giáo viên có tên “Nguyen To Lan” dạy môn “Co So Du Lieu”.
          SELECT HO + ' ' + TEN AS HOTEN FROM HOCVIEN
          WHERE MAHV IN (
          	SELECT TRGLOP FROM LOP 
          	WHERE MALOP IN (
          		SELECT DISTINCT MALOP FROM GIANGDAY 
          		WHERE MAGV IN (
          			SELECT MAGV FROM GIAOVIEN WHERE HOTEN = 'Nguyen To Lan'
          		) AND MAMH IN (
          			SELECT MAMH FROM MONHOC WHERE TENMH = 'Co So Du Lieu'
          		)
          	)
          )

          
          -- 9.	In ra danh sách những môn học (mã môn học, tên môn học) phải học liền trước môn “Co So Du Lieu”.
          SELECT MAMH, TENMH FROM MONHOC
          WHERE MAMH IN (
          	SELECT MAMH_TRUOC FROM DIEUKIEN WHERE MAMH IN (
          		SELECT MAMH FROM MONHOC WHERE TENMH = 'Co So Du Lieu'
          	)
          )
          
          
          -- 10.	Môn “Cau Truc Roi Rac” là môn bắt buộc phải học liền trước những môn học (mã môn học, tên môn học) nào.
          SELECT MAMH, TENMH FROM MONHOC
          WHERE MAMH IN (
          	SELECT MAMH FROM DIEUKIEN WHERE MAMH_TRUOC IN (
          		SELECT MAMH FROM MONHOC WHERE TENMH = 'Cau Truc Roi Rac'
          	)
          )
          


BÀI TẬP 4:
          --14. In ra danh sách các sản phẩm (MASP, TENSP) do “Trung Quoc” sản xuất hoặc các sản phẩm được bán ra trong ngày 1/1/2007.
          SELECT MASP, TENSP
          FROM SANPHAM
          WHERE NUOCSX = 'Trung Quoc'
          UNION
          SELECT SP.MASP, SP.TENSP
          FROM SANPHAM SP
          JOIN CTHD CT ON SP.MASP = CT.MASP
          JOIN HOADON HD ON CT.SOHD = HD.SOHD
          WHERE HD.NGHD = '2007-01-01';

          --15. In ra danh sách các sản phẩm (MASP,TENSP) không bán được.
          SELECT MASP, TENSP
          FROM SANPHAM
          WHERE MASP NOT IN (SELECT DISTINCT MASP FROM CTHD);

          --16. In ra danh sách các sản phẩm (MASP,TENSP) không bán được trong năm 2006.
          SELECT MASP, TENSP
          FROM SANPHAM
          WHERE MASP NOT IN (
              SELECT DISTINCT CT.MASP
              FROM CTHD CT
              JOIN HOADON HD ON CT.SOHD = HD.SOHD
              WHERE YEAR(HD.NGHD) = 2006
          );

          --17. In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất không bán được trong năm 2006.
          SELECT MASP, TENSP
          FROM SANPHAM
          WHERE NUOCSX = 'Trung Quoc'
            AND MASP NOT IN (
              SELECT DISTINCT CT.MASP
              FROM CTHD CT
              JOIN HOADON HD ON CT.SOHD = HD.SOHD
              WHERE YEAR(HD.NGHD) = 2006
          );
          --18. Tìm số hóa đơn trong năm 2006 đã mua ít nhất tất cả các sản phẩm do Singapore sản xuất.
          SELECT HD.SOHD
          FROM HOADON HD
          JOIN CTHD CT ON HD.SOHD = CT.SOHD
          JOIN SANPHAM SP ON CT.MASP = SP.MASP
          WHERE YEAR(HD.NGHD) = 2006
            AND SP.NUOCSX = 'Singapore'
          GROUP BY HD.SOHD
          HAVING COUNT(DISTINCT SP.MASP) = (SELECT COUNT(DISTINCT MASP) FROM SANPHAM WHERE NUOCSX = 'Singapore');


BÀI TẬP 5:
          -- 11.	Tìm họ tên giáo viên dạy môn CTRR cho cả hai lớp “K11” và “K12” trong cùng học kỳ 1 năm 2006.
          SELECT HOTEN FROM GIAOVIEN 
          WHERE MAGV IN (
          	SELECT MAGV FROM GIANGDAY 
          	WHERE MAMH = 'CTRR' AND MALOP IN ('K11', 'K12') AND HOCKY = 1 AND NAM = 2006
          	GROUP BY MAGV 
          	HAVING COUNT(DISTINCT MALOP) = 2
          )
          
          
          -- 12.	Tìm những học viên (mã học viên, họ tên) thi không đạt môn CSDL ở lần thi thứ 1 nhưng chưa thi lại môn này.
          SELECT MAHV, HO + ' ' + TEN AS HOTEN FROM HOCVIEN 
          WHERE MAHV IN (
          	SELECT MAHV FROM KETQUATHI A
          	WHERE NOT EXISTS (
          		SELECT 1 FROM KETQUATHI B 
          		WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH AND A.LANTHI < B.LANTHI
          	) AND MAMH = 'CSDL' AND LANTHI = 1 AND KQUA = 'Khong Dat'
          )
          
          
          -- 13.	Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào.
          SELECT MAGV, HOTEN FROM GIAOVIEN 
          WHERE MAGV NOT IN (
          	SELECT DISTINCT MAGV FROM GIANGDAY
          )
          
          
          -- 14.	Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào thuộc khoa giáo viên đó phụ trách.
          SELECT MAGV, HOTEN FROM GIAOVIEN 
          WHERE MAGV NOT IN (
          	SELECT GD.MAGV
          	FROM GIANGDAY GD INNER JOIN GIAOVIEN GV 
          	ON GD.MAGV = GV.MAGV INNER JOIN MONHOC MH
          	ON GD.MAMH = MH.MAMH
          	WHERE GV.MAKHOA = MH.MAKHOA
          )
          
          
          -- 15.	Tìm họ tên các học viên thuộc lớp “K11” thi một môn bất kỳ quá 3 lần vẫn “Khong dat” hoặc thi lần thứ 2 môn CTRR được 5 điểm.
          SELECT HO + ' ' + TEN AS HOTEN FROM HOCVIEN
          WHERE MAHV IN (
          	SELECT MAHV FROM KETQUATHI A
          	WHERE LEFT(MAHV, 3) = 'K11' AND ((
          		NOT EXISTS (
          			SELECT 1 FROM KETQUATHI B 
          			WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH AND A.LANTHI < B.LANTHI
          		)  AND LANTHI = 3 AND KQUA = 'Khong Dat'
          	) OR MAMH = 'CTRR' AND LANTHI = 2 AND DIEM = 5)
          )
          
          
          -- 16.	Tìm họ tên giáo viên dạy môn CTRR cho ít nhất hai lớp trong cùng một học kỳ của một năm học.
          SELECT HOTEN FROM GIAOVIEN 
          WHERE MAGV IN (
          	SELECT MAGV FROM GIANGDAY 
          	WHERE MAMH = 'CTRR'
          	GROUP BY MAGV, HOCKY, NAM 
          	HAVING COUNT(MALOP) >= 2
          )
          
          
          -- 17.	Danh sách học viên và điểm thi môn CSDL (chỉ lấy điểm của lần thi sau cùng).
          SELECT HV.MAHV, HO + ' ' + TEN AS HOTEN, DIEM 
          FROM HOCVIEN HV INNER JOIN (
          	SELECT MAHV, DIEM 
          	FROM KETQUATHI A
          	WHERE NOT EXISTS (
          		SELECT 1 
          		FROM KETQUATHI B 
          		WHERE A.MAHV = B.MAHV AND A.MAMH = B.MAMH
HOMEWORK:
                    
          --8. Hiển thị tên và cấp độ của tất cả các kỹ năng của chuyên gia có MaChuyenGia là 1.
          SELECT K.TenKyNang, CGK.CapDo
          FROM ChuyenGia_KyNang CGK
          JOIN KyNang K ON CGK.MaKyNang = K.MaKyNang
          WHERE CGK.MaChuyenGia = 1;
          --9. Liệt kê tên các chuyên gia tham gia dự án có MaDuAn là 2.     
          SELECT CG.HoTen
          FROM ChuyenGia_DuAn CGD
          JOIN ChuyenGia CG ON CGD.MaChuyenGia = CG.MaChuyenGia
          WHERE CGD.MaDuAn = 2;
          --10. Hiển thị tên công ty và tên dự án của tất cả các dự án.       
          SELECT C.TenCongTy, D.TenDuAn
          FROM DuAn D
          JOIN CongTy C ON D.MaCongTy = C.MaCongTy;
          --11. Đếm số lượng chuyên gia trong mỗi chuyên ngành.    
          SELECT ChuyenNganh, COUNT(*) AS SoLuongChuyenGia
          FROM ChuyenGia
          GROUP BY ChuyenNganh;
          --12. Tìm chuyên gia có số năm kinh nghiệm cao nhất.        
          SELECT TOP 1 *
          FROM ChuyenGia
          ORDER BY NamKinhNghiem DESC;
          --13. Liệt kê tên các chuyên gia và số lượng dự án họ tham gia.      
          SELECT CG.HoTen, COUNT(CGD.MaDuAn) AS SoLuongDuAn
          FROM ChuyenGia CG
          LEFT JOIN ChuyenGia_DuAn CGD ON CG.MaChuyenGia = CGD.MaChuyenGia
          GROUP BY CG.HoTen;
          --14. Hiển thị tên công ty và số lượng dự án của mỗi công ty.          
          SELECT C.TenCongTy, COUNT(D.MaDuAn) AS SoLuongDuAn
          FROM CongTy C
          LEFT JOIN DuAn D ON C.MaCongTy = D.MaCongTy
          GROUP BY C.TenCongTy;
          --15. Tìm kỹ năng được sở hữu bởi nhiều chuyên gia nhất.       
          SELECT TOP 1 K.TenKyNang
          FROM KyNang K
          JOIN ChuyenGia_KyNang CGK ON K.MaKyNang = CGK.MaKyNang
          GROUP BY K.TenKyNang
          ORDER BY COUNT(CGK.MaChuyenGia) DESC;

          --16. Liệt kê tên các chuyên gia có kỹ năng 'Python' với cấp độ từ 4 trở lên.     
          SELECT CG.HoTen
          FROM ChuyenGia CG
          JOIN ChuyenGia_KyNang CGK ON CG.MaChuyenGia = CGK.MaChuyenGia
          JOIN KyNang K ON CGK.MaKyNang = K.MaKyNang
          WHERE K.TenKyNang = 'Python' AND CGK.CapDo >= 4;
          --17. Tìm dự án có nhiều chuyên gia tham gia nhất.      
          SELECT D.TenDuAn
          FROM DuAn D
          JOIN ChuyenGia_DuAn CGD ON D.MaDuAn = CGD.MaDuAn
          GROUP BY D.TenDuAn
          ORDER BY COUNT(CGD.MaChuyenGia) DESC
          LIMIT 1;
          --18. Hiển thị tên và số lượng kỹ năng của mỗi chuyên gia.        
          SELECT CG.HoTen, COUNT(CGK.MaKyNang) AS SoLuongKyNang
          FROM ChuyenGia CG
          LEFT JOIN ChuyenGia_KyNang CGK ON CG.MaChuyenGia = CGK.MaChuyenGia
          GROUP BY CG.HoTen;
          --19. Tìm các cặp chuyên gia làm việc cùng dự án.          
          SELECT A.HoTen AS ChuyenGia1, B.HoTen AS ChuyenGia2
          FROM ChuyenGia_DuAn CGD1
          JOIN ChuyenGia_DuAn CGD2 ON CGD1.MaDuAn = CGD2.MaDuAn AND CGD1.MaChuyenGia < CGD2.MaChuyenGia
          JOIN ChuyenGia A ON CGD1.MaChuyenGia = A.MaChuyenGia
          JOIN ChuyenGia B ON CGD2.MaChuyenGia = B.MaChuyenGia;
          --20. Liệt kê tên các chuyên gia và số lượng kỹ năng cấp độ 5 của họ.        
          SELECT CG.HoTen, COUNT(CGK.MaKyNang) AS SoLuongKyNangCapDo5
          FROM ChuyenGia CG
          JOIN ChuyenGia_KyNang CGK ON CG.MaChuyenGia = CGK.MaChuyenGia
          WHERE CGK.CapDo = 5
          GROUP BY CG.HoTen;
          --21. Tìm các công ty không có dự án nào.   
          SELECT C.TenCongTy
          FROM CongTy C
          LEFT JOIN DuAn D ON C.MaCongTy = D.MaCongTy
          WHERE D.MaDuAn IS NULL;
          --22. Hiển thị tên chuyên gia và tên dự án họ tham gia, bao gồm cả chuyên gia không tham gia dự án nào.
          SELECT CG.HoTen, D.TenDuAn
          FROM ChuyenGia CG
          LEFT JOIN ChuyenGia_DuAn CGD ON CG.MaChuyenGia = CGD.MaChuyenGia
          LEFT JOIN DuAn D ON CGD.MaDuAn = D.MaDuAn;
          --23. Tìm các chuyên gia có ít nhất 3 kỹ năng.          
          SELECT CG.HoTen
          FROM ChuyenGia CG
          JOIN ChuyenGia_KyNang CGK ON CG.MaChuyenGia = CGK.MaChuyenGia
          GROUP BY CG.MaChuyenGia
          HAVING COUNT(CGK.MaKyNang) >= 3;
          --24. Hiển thị tên công ty và tổng số năm kinh nghiệm của tất cả chuyên gia trong các dự án của công ty đó.       
          SELECT C.TenCongTy, SUM(CG.NamKinhNghiem) AS TongNamKinhNghiem
          FROM CongTy C
          JOIN DuAn D ON C.MaCongTy = D.MaCongTy
          JOIN ChuyenGia_DuAn CGD ON D.MaDuAn = CGD.MaDuAn
          JOIN ChuyenGia CG ON CGD.MaChuyenGia = CG.MaChuyenGia
          GROUP BY C.TenCongTy;
          --25. Tìm các chuyên gia có kỹ năng 'Java' nhưng không có kỹ năng 'Python'.
          SELECT CG.HoTen
          FROM ChuyenGia CG
          JOIN ChuyenGia_KyNang CGK1 ON CG.MaChuyenGia = CGK1.MaChuyenGia
          JOIN KyNang K1 ON CGK1.MaKyNang = K1.MaKyNang AND K1.TenKyNang = 'Java'
          LEFT JOIN ChuyenGia_KyNang CGK2 ON CG.MaChuyenGia = CGK2.MaChuyenGia
          LEFT JOIN KyNang K2 ON CGK2.MaKyNang = K2.MaKyNang AND K2.TenKyNang = 'Python'
          WHERE K2.TenKyNang IS NULL;

          --76. Tìm chuyên gia có số lượng kỹ năng nhiều nhất.     
          SELECT CG.HoTen
          FROM ChuyenGia CG
          JOIN ChuyenGia_KyNang CGK ON CG.MaChuyenGia = CGK.MaChuyenGia
          GROUP BY CG.HoTen
          ORDER BY COUNT(CGK.MaKyNang) DESC
          LIMIT 1;
          --77. Liệt kê các cặp chuyên gia có cùng chuyên ngành.        
          SELECT A.HoTen AS ChuyenGia1, B.HoTen AS ChuyenGia2
          FROM ChuyenGia A
          JOIN ChuyenGia B ON A.ChuyenNganh = B.ChuyenNganh AND A.MaChuyenGia < B.MaChuyenGia;
          --78. Tìm công ty có tổng số năm kinh nghiệm của các chuyên gia trong dự án cao nhất.          
          SELECT C.TenCongTy
          FROM CongTy C
          JOIN DuAn D ON C.MaCongTy = D.MaCongTy
          JOIN ChuyenGia_DuAn CGD ON D.MaDuAn = CGD.MaDuAn
          JOIN ChuyenGia CG ON CGD.MaChuyenGia = CG.MaChuyenGia
          GROUP BY C.TenCongTy
          ORDER BY SUM(CG.NamKinhNghiem) DESC
          LIMIT 1;
          --79. Tìm kỹ năng được sở hữu bởi tất cả các chuyên gia.       
          SELECT K.TenKyNang
          FROM KyNang K
          WHERE NOT EXISTS (
              SELECT 1
              FROM ChuyenGia CG
              WHERE NOT EXISTS (
                  SELECT 1
                  FROM ChuyenGia_KyNang CGK
                  WHERE CGK.MaKyNang = K.MaKyNang AND CGK.MaChuyenGia = CG.MaChuyenGia
              )
          );


          
