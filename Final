CREATE TABLE NHACUNGCAP (
    MANCC VARCHAR(10) PRIMARY KEY,
    TENNCC NVARCHAR(20),
    QUOCGIA NVARCHAR(20),
    LOAICC NVARCHAR(10)
);
GO
CREATE TABLE DUOCPHAM (
    MADP VARCHAR(10) PRIMARY KEY,
    TENDP NVARCHAR(20),
    LOAIDP VARCHAR(20),
    GIA MONEY
)
GO
CREATE TABLE PHIEUNHAP (
    SOPN VARCHAR(10) PRIMARY KEY,
    NGNHAP SMALLDATETIME,
    MANCC VARCHAR(10)
);
ALTER TABLE PHIEUNHAP 
ADD LOAINHAP NVARCHAR(50)
GO 
CREATE TABLE CTPN (
    SOPN VARCHAR(10),
    MADP VARCHAR(10),
    SOLUONG INT
    PRIMARY KEY (SOPN, MADP)
)
ALTER TABLE NHACUNGCAP
ALTER COLUMN LOAICC NVARCHAR(20);

ALTER TABLE DUOCPHAM
ALTER COLUMN TENDP NVARCHAR(50);

alter table NHACUNGCAP 
alter column TENNCC NVARCHAR(100)

GO
ALTER TABLE PHIEUNHAP 
ADD CONSTRAINT FK_MANCC FOREIGN KEY (MANCC) REFERENCES dbo.NHACUNGCAP(MANCC)

ALTER TABLE CTPN 
ADD CONSTRAINT FK_MADP FOREIGN KEY (MADP) REFERENCES dbo.DUOCPHAM(MADP)


ALTER TABLE CTPN 
ADD CONSTRAINT FK_SOPN FOREIGN KEY (SOPN) REFERENCES dbo.PHIEUNHAP(SOPN)

INSERT INTO NHACUNGCAP (MANCC, TENNCC, QUOCGIA, LOAICC)
VALUES 
('NCC01', N'Phuc Hung', N'Viet Nam', N'Thuong xuyen'),
('NCC02', N'J. B. Pharmaceuticals', N'India', N'Vang lai'),
('NCC03', N'Sapharco', N'Singapore', N'Vang lai');

INSERT INTO DUOCPHAM (MADP, TENDP, LOAIDP, GIA)
VALUES 
('DP01', N'Thuoc ho PH', N'Siro', 120000),
('DP02', N'Zecuf Herbal CouchRemedy', N'Vien nen', 200000),
('DP03', N'Cotrim', N'Vien sui', 80000);

INSERT INTO PHIEUNHAP (SOPN, NGNHAP, MANCC)
VALUES 
('00001', '2017-11-22', 'NCC01'),
('00002', '2017-12-04', 'NCC03'),
('00003', '2017-12-10', 'NCC02');

INSERT INTO CTPN (SOPN, MADP, SOLUONG)
VALUES 
('00001', 'DP01', 100),
('00001', 'DP02', 200),
('00003', 'DP03', 543);

UPDATE PHIEUNHAP
SET LOAINHAP = N'Nội địa'
WHERE MANCC IN (
    SELECT MANCC FROM NHACUNGCAP WHERE QUOCGIA = N'Viet Nam'
);

UPDATE PHIEUNHAP
SET LOAINHAP = N'Nhập khẩu'
WHERE MANCC IN (
    SELECT MANCC FROM NHACUNGCAP WHERE QUOCGIA <> N'Viet Nam'
);


ALTER TABLE DUOCPHAM
ADD CONSTRAINT CK_DUOCPHAM_GIA CHECK (
    NOT (LOAIDP = 'Siro' AND GIA <= 100000)
);


